<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <title>Posts &laquo; Admin</title>
  <link rel="stylesheet" href="../assets/vendors/bootstrap/css/bootstrap.css">
  <link rel="stylesheet" href="../assets/vendors/font-awesome/css/font-awesome.css">
  <link rel="stylesheet" href="../assets/vendors/nprogress/nprogress.css">
  <link rel="stylesheet" href="../assets/css/admin.css">
  <script src="../assets/vendors/nprogress/nprogress.js"></script>
</head>
<body>
  <div class="main" id="app">
    <nav class="navbar">
      <button class="btn btn-default navbar-btn fa fa-bars"></button>
      <ul class="nav navbar-nav navbar-right">
        <li><a href="profile.html"><i class="fa fa-user"></i>个人中心</a></li>
        <li><a href="login.html"><i class="fa fa-sign-out"></i>退出</a></li>
      </ul>
    </nav>
    <div class="container-fluid">
      <div class="page-title">
        <h1>所有文章</h1>
        <a href="post-add.html" class="btn btn-primary btn-xs">写文章</a>
      </div>
      <div style="display: flex;justify-content:space-between;margin-bottom: 18px;padding: 0px;">
          <!--查询条件-->
          <div style="display: flex;">
              <select class="form-control input-sm" style="width: 120px;" v-model="typeId" @change="change">
                  <option value="">文章分类</option>
                  <option v-for="type in typeList"  :value="type.id">{{type.name}}</option>
              </select>

              <select class="form-control input-sm" style="width: 120px;" v-model="statusId" @change="change">
                  <option value="">发布状态</option>
                  <option v-for="status in statusList"  :value="status.k">{{getStatus(status.k)}}</option>
              </select>
          </div>
          <!--分页相关-->
          <div style="display: flex;">
              <ul class="pagination pagination-sm">
                  <li>
                      <a href="#" aria-label="Previous">
                          <span aria-hidden="true" @click="page(1)">首页</span>
                      </a>
                  </li>
                  <li>
                      <a href="#" aria-label="Previous">
                          <span aria-hidden="true" @click="page(currentPage==1?1:currentPage-1)">上一页</span>
                      </a>
                  </li>
                  <li v-for="(i,k) in totalPage" :class="currentPage==i?bg:''" v-if="(startPage<=i)&&(i<=endPage)"><a @click="page(i)">{{i}}</a></li>
                  <li>
                      <a href="#" aria-label="Next">
                          <span aria-hidden="true" @click="page(currentPage==totalPage?currentPage:currentPage+1)">下一页</span>
                      </a>
                  </li>
                  <li>
                      <a href="#" aria-label="Previous">
                          <span aria-hidden="true" @click="page(totalPage)">尾页</span>
                      </a>
                  </li>
              </ul>
              <!--分页条数选择-->
              <select class="form-control" style="width: 70px; margin-left: 20px" v-model="pageSize" @change="change">
                  <option value="5">5</option>
                  <option value="10">10</option>
                  <option value="20">20</option>
                  <option value="30">30</option>
                  <option value="40">40</option>
              </select>
          </div>
      </div>


      <table class="table table-striped table-bordered table-hover">
        <thead>
          <tr>
            <th class="text-center" width="40"><input type="checkbox"></th>
            <th>标题</th>
            <th>分类</th>
            <th class="text-center">发表时间</th>
            <th class="text-center">状态</th>
            <th class="text-center" width="100">操作</th>
          </tr>
        </thead>
        <tbody>

          <tr v-for="info in infoList">
            <td class="text-center"><input type="checkbox"></td>
            <td>{{info.title}}</td>
            <td>{{getTypeName(info.typeId)}}</td>
            <td class="text-center">{{info.createDate}}</td>
            <td class="text-center">{{getStatus(info.status)}}</td>
            <td class="text-center">
              <button class="btn btn-default btn-xs">编辑</button>
              <button class="btn btn-danger btn-xs">删除</button>
            </td>
          </tr>
        </tbody>
      </table>

    </div>
  </div>

  <div class="aside" id="aside">
    <div class="profile">
      <img class="avatar" src="../uploads/avatar.jpg">
        <input class="upload" @change='add_img' type="file">
      <h3 class="name">布头儿</h3>
    </div>

    <ul class="nav">
      <li>
        <a href="index.html"><i class="fa fa-dashboard"></i>仪表盘</a>
      </li>
      <li class="active">
        <a href="#menu-posts" data-toggle="collapse">
          <i class="fa fa-thumb-tack"></i>文章<i class="fa fa-angle-right"></i>
        </a>
        <ul id="menu-posts" class="collapse in">
          <li class="active"><a href="articleList.html">所有文章</a></li>
          <li><a href="post-add.html">写文章</a></li>
          <li><a href="articleType.html">分类目录</a></li>
        </ul>
      </li>
      <li>
        <a href="comments.html"><i class="fa fa-comments"></i>评论</a>
      </li>
      <li>
        <a href="users.html"><i class="fa fa-users"></i>用户</a>
      </li>
      <li>
        <a href="#menu-settings" class="collapsed" data-toggle="collapse">
          <i class="fa fa-cogs"></i>设置<i class="fa fa-angle-right"></i>
        </a>
        <ul id="menu-settings" class="collapse">
          <li><a href="nav-menus.html">导航菜单</a></li>
          <li><a href="slides.html">图片轮播</a></li>
          <li><a href="settings.html">网站设置</a></li>
        </ul>
      </li>
    </ul>
  </div>

  <script src="../assets/vendors/jquery/jquery.js"></script>
  <script src="../assets/vendors/bootstrap/js/bootstrap.js"></script>
  <script src="https://unpkg.com/vue"></script>
  <script src="../assets/vendors/vue/axios.min.js"></script>
  <script src="../assets/vendors/common.js"></script>
  <script>
      var vm = new Vue({
          el: '#app',
          data: {
              //相关变量
              infoList: {},
              typeList:{},
              typeId:'',
              statusId:'',
              statusList:[
                  {k: 1, v: '草稿'},
                  {k: 2, v: '后台'},
                  {k: 3, v: '游客'}
              ],

              //相关rl
              listUrl: '',
              typeListUrl:'',

              //分页相关
              totalCount: '',
              currentPage: '',
              pageSize: 5,
              showPage: 3,
              bg:'active'

          },
          computed: {
              //总的分页数量
              totalPage: function () {
                  return Math.ceil(Number(this.totalCount) / Number(this.pageSize))
              },
              startPage: function () {
                  if (this.totalPage <= this.showPage) {
                      return 1;
                  }
                  if (this.currentPage <= Math.ceil(Number(this.showPage) / 2)) {
                      return 1;
                  }
                  let start = this.currentPage - (Math.floor(Number(this.showPage) / 2));
                  return start;
              },
              endPage: function () {
                  if (this.totalPage <= this.showPage) {
                      return this.totalPage;
                  }
                  return this.startPage + this.showPage - 1
              }
          },
          methods: {
              //文章分页
              page(i,typeId) {
                  if (!i) {
                      this.currentPage = 1;
                  } else {
                      this.currentPage = i;
                  }
                  if (!typeId) {
                      typeId = "";
                  }
                  this.listUrl = domain+'/article/page';
                  axios.post(this.listUrl, "currentPage=" + this.currentPage + "&pageSize=" + this.pageSize+"&typeId="+typeId+"&status="+this.statusId).then(res => {
                      this.infoList = res.data.data.data
                      this.totalCount = res.data.data.totalCount
                      this.currentPage = res.data.data.currentPage
                  })
              },
              //获取所有分类列表
              getTypeList(){
                  this.typeListUrl= domain+'/articleType/queryAll';
                  axios.post(this.typeListUrl).then(res => {
                      this.typeList = res.data.data
                  })
              },
              //修改下拉框刷新分页
              change() {
                  this.page(1, this.typeId);
              },
              //根据分类id拿到分类名称
              getTypeName(typeId) {
                  const info  = this.typeList.find((item,index)=>{
                      return item.id === typeId
                  })
                  return info.name;
              },
              //获取文章状态
              getStatus(status) {
                  const info  = this.statusList.find((item,index)=>{
                      return item.k === status
                  })
                  return info.v;
              }
          },
          created: function () {
              this.page();
              this.getTypeList();
          }
      });
      new Vue({
          el:'#aside',
          data:{
          },
          methods:{
              add_img(event) {
                  upload(event);
              }
          }
      })
  </script>
</body>
</html>
